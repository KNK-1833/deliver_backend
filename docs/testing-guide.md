# テストガイド

配送サポートシステムのテスト手順とアカウント情報をまとめています。

## 📋 テストアカウント

### 🌱 シードユーザー
  - メールアドレス: seed@test.com
  - パスワード: test123
  - 機能: 案件管理・ドライバー割り当て・報酬設定

### 🏢 事業者ユーザー（配送依頼を作成する側）
- **メールアドレス**: `company@test.com`
- **パスワード**: `test123`
- **ユーザータイプ**: 事業者

**利用可能機能**:
- 配送依頼作成
- 配送依頼一覧・管理
- ファイルアップロード（Claude AI連携）

### 🚛 ドライバーユーザー（配送を担当する側）
- **メールアドレス**: `driver@test.com`
- **パスワード**: `test123`
- **ユーザータイプ**: ドライバー

**利用可能機能**:
- 利用可能案件一覧
- 案件受諾
- マイアサイン管理・ステータス更新

### 👑 管理者ユーザー（システム管理）
- **メールアドレス**: `admin@test.com`
- **パスワード**: `admin123`
- **ユーザータイプ**: 管理者

**利用可能機能**:
- 全ての事業者機能
- Django管理画面アクセス

## 🚀 サーバー起動手順

### 1. バックエンドサーバー起動

```bash
# プロジェクトルートで実行
cd backend
python manage.py runserver
```

**確認**: http://localhost:8000/admin/ にアクセスしてDjango管理画面が表示されることを確認

### 2. フロントエンドサーバー起動（別ターミナル）

```bash
# プロジェクトルートで実行
cd frontend
npm start
```

**確認**: http://localhost:3000 にアクセスしてReactアプリが表示されることを確認

## 🧪 基本テストシナリオ

### シナリオ1: 事業者による配送依頼作成

1. **ログイン**
   - http://localhost:3000 にアクセス
   - 事業者アカウント（`company@test.com` / `test123`）でログイン

2. **配送依頼作成**
   - ダッシュボードで「新規作成」ボタンをクリック
   - 以下の情報を入力:
     ```
     配送依頼名: 東京駅→新宿駅 書類配送
     
     【配送元】
     住所: 東京都千代田区丸の内1-1-1
     担当者名: 山田太郎
     電話番号: 03-1234-5678
     
     【配送先】
     住所: 東京都新宿区西新宿2-2-2
     担当者名: 佐藤花子
     電話番号: 03-5678-9012
     
     【配送詳細】
     配送希望日時: 明日の午後
     配送料金: 3000円
     荷物サイズ: 小（60サイズ）
     重量: 2kg
     特別指示: 直接手渡し希望
     ```

3. **配送依頼確認**
   - 「配送依頼を作成」ボタンをクリック
   - 配送依頼一覧画面で作成した依頼が表示されることを確認

### シナリオ2: ドライバーによる案件受諾

1. **ログアウト・ログイン**
   - 右上のユーザーメニューからログアウト
   - ドライバーアカウント（`driver@test.com` / `test123`）でログイン

2. **案件検索・受諾**
   - ダッシュボードで「案件を見る」ボタンをクリック
   - 利用可能案件一覧で事業者が作成した案件を確認
   - 「案件を受諾」ボタンをクリック

3. **マイアサイン確認**
   - ダッシュボードで「アサイン確認」ボタンをクリック
   - 受諾した案件が表示されることを確認

### シナリオ3: 配送ステータス更新

1. **ステータス更新**
   - マイアサイン画面で受諾した案件の「集荷完了」ボタンをクリック
   - ステータスが「集荷済み」に更新されることを確認

2. **配送開始**
   - 「配送開始」ボタンをクリック
   - ステータスが「配送中」に更新されることを確認

3. **配送完了**
   - 「配送完了」ボタンをクリック
   - ステータスが「配送完了」に更新されることを確認
   - 完了メッセージが表示されることを確認

## 📁 ファイルアップロードテスト

### シナリオ4: Claude AI連携テスト

1. **事業者でログイン**
   - 事業者アカウントでログイン

2. **ファイルアップロード**
   - ダッシュボードで「アップロード」ボタンをクリック
   - テスト用画像ファイル（JPG/PNG）またはPDFをアップロード
   - ※実際のClaude API連携は環境変数 `CLAUDE_API_KEY` が設定されている場合のみ動作

3. **AI処理**
   - 「AI処理を開始」ボタンをクリック
   - 抽出データが表示されることを確認（モック実装の場合）

4. **配送依頼作成**
   - 「配送依頼を作成」ボタンをクリック
   - 自動的に配送依頼一覧に遷移することを確認

## 🔧 Django管理画面テスト

### 管理画面アクセス

1. **管理者ログイン**
   - http://localhost:8000/admin/ にアクセス
   - 管理者アカウント（`admin@test.com` / `admin123`）でログイン

2. **データ確認**
   - Users → ユーザー一覧でテストユーザーを確認
   - Delivery requests → 配送依頼一覧を確認
   - Assignments → アサイン一覧を確認
   - File uploads → アップロードファイル一覧を確認

## 🧪 APIテスト

### 自動テスト実行

```bash
# プロジェクトルートで実行
python run_tests.py

# カバレッジ測定付き
python run_tests.py --coverage

# 特定モジュールのみ
python run_tests.py --module users
```

### 手動APIテスト

#### 認証テスト
```bash
# ユーザー登録
curl -X POST http://localhost:8000/api/auth/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "testpass123",
    "password_confirm": "testpass123",
    "phone_number": "090-1234-5678",
    "user_type": "company"
  }'

# ログイン
curl -X POST http://localhost:8000/api/auth/token/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "company@test.com",
    "password": "test123"
  }'
```

#### 配送依頼API テスト
```bash
# 配送依頼一覧取得（要認証トークン）
curl -X GET http://localhost:8000/api/delivery/requests/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

## ❗ トラブルシューティング

### よくある問題と解決方法

1. **サーバーが起動しない**
   - ポート3000, 8000が既に使用されていないか確認
   - 仮想環境がアクティブになっているか確認

2. **ログインできない**
   - テストユーザーが作成されているか確認:
     ```bash
     cd backend
     python manage.py shell -c "
     from django.contrib.auth import get_user_model
     User = get_user_model()
     print([u.email for u in User.objects.all()])
     "
     ```

3. **APIエラーが発生する**
   - Django開発サーバーのログを確認
   - ブラウザの開発者ツールでネットワークエラーを確認

4. **CORS エラー**
   - `backend/config/settings.py` の `CORS_ALLOWED_ORIGINS` 設定を確認

5. **Claude API エラー**
   - `backend/.env` ファイルで `CLAUDE_API_KEY` が設定されているか確認
   - 設定されていない場合はモック実装が動作

## 📊 期待される結果

正常に動作している場合:

- ✅ 事業者は配送依頼を作成できる
- ✅ ドライバーは案件を受諾できる
- ✅ ステータス更新が正常に動作する
- ✅ ファイルアップロード機能が動作する
- ✅ レスポンシブデザインが適用される
- ✅ エラーハンドリングが適切に動作する

## 🎯 テスト完了チェックリスト

- [ ] 事業者ユーザーでログイン・配送依頼作成
- [ ] ドライバーユーザーでログイン・案件受諾
- [ ] ステータス更新フロー（アサイン→集荷→配送中→完了）
- [ ] ファイルアップロード機能
- [ ] 管理画面アクセス・データ確認
- [ ] 自動テスト実行・全テスト成功
- [ ] レスポンシブデザイン確認（モバイル・デスクトップ）
- [ ] エラーケースの動作確認

すべてのチェックリストが完了すれば、システムが正常に動作していることが確認できます。